name: first-time-setup
run-name: first time setup of repo

# run when branch created (repo generated from template)
on:
  push:
    branches:
      - main

# only keep latest run of this workflow
concurrency:
  group: first-time-setup
  cancel-in-progress: true

jobs:
  first-time-setup:
    # ensure run only once, when repo generated
    if: github.run_number == 1

    runs-on: ubuntu-latest

    permissions:
      contents: write

    steps:
      # get main branch repo contents
      - name: Checkout code
        uses: actions/checkout@v4

      # remove files not needed for user instance of template
      - name: Remove unneeded files
        run: rm -f README.md .github/workflows/docker-image-verification.yml .github/workflows/first-setup.yml

      # personalize readme for user
      - name: Init readme
        run: |
          echo "
          # ${{ github.repository_name }}

          Welcome to the **${{ github.repository_name }}** repository! This repository was generated from a template to get you started quickly.

          ## ðŸš€ Getting Started

          To get started with this project:

          1. Clone the repository:
             \`\`\`bash
             git clone https://github.com/${{ github.repository }}.git
             cd ${{ github.repository_name }}
             \`\`\`
          2. Install any dependencies (if applicable).
          3. Follow the instructions in the relevant documentation or project files to start working.

          ## ðŸ“ Project Structure

          The repository contains the following directories and files:

          - \`src/\` - Your source code or main project files.
          - \`docs/\` - Documentation and guides.
          - \`tests/\` - Unit tests and test scripts.
          - \`README.md\` - This file.
          - \`.github/\` - GitHub Actions workflows and configuration.

          *(Adjust the structure as needed for your project.)*

          ## ðŸ›  Features

          - Initialized from a reusable template for quick setup.
          - Pre-configured workflows for automation and CI/CD.
          - Placeholder sections for documentation, testing, and development.

          ## ðŸ“– Documentation

          Check the project files and comments for guidance. You can expand this section as your project grows.

          ## ðŸ¤ Contributing

          Contributions are welcome! Feel free to open issues, submit pull requests, or suggest improvements.

          ## ðŸ“ License

          Specify your license here (if any). For example: MIT, Apache 2.0, etc.

          Happy coding! ðŸŽ‰

          " > README.md

      # save changed files
      - name: Commit changed files
        uses: stefanzweifel/git-auto-commit-action@v4
        with:
          commit_message: "Setup repo"
